#!/bin/bash

BROWSER=
if [[ "$@" == *"firefox"* ]]; then
  BROWSER="${BROWSER} firefox"
fi

if [[ "$@" == *"chrome"* ]]; then
  BROWSER="${BROWSER} chrome"
fi

if [ "${BROWSER}x" == "x" ]; then
  BROWSER=firefox
fi

cd $(dirname $0)/..

docker-compose -f docker/docker-compose.yml -f docker/docker-compose.browsers.yml up -d $BROWSER
sleep 2

./bin/phpcli ./bin/codecept-wrapper "$@"
RET=$?

docker-compose -f docker/docker-compose.yml -f docker/docker-compose.browsers.yml stop $BROWSER
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.browsers.yml rm -f -v $BROWSER

exit $RET
